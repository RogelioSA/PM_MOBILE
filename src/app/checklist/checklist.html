<app-menu></app-menu>

<div class="min-h-screen bg-gray-100 dark:bg-slate-900 p-4 sm:p-6 pt-20 sm:pt-24">
  <div class="max-w-7xl mx-auto">
    <h1 class="text-lg sm:text-xl font-bold text-gray-800 dark:text-white mb-4 sm:mb-6">
      Checklist PDI - Recepción de Unidad
    </h1>

    <!-- DATOS DEL VEHÍCULO -->
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-4 sm:p-6 mb-4">
      <h2 class="text-base sm:text-lg font-bold text-gray-800 dark:text-white mb-4">
        DATOS DEL VEHÍCULO
      </h2>

      <form [formGroup]="form" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Sucursal -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Sucursal <span class="text-red-500">*</span>
          </label>
          <p-select formControlName="sucursal" [options]="sucursales" optionLabel="label" optionValue="value"
            placeholder="Seleccione sucursal" />
        </div>

        <!-- Almacén -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Almacén <span class="text-red-500">*</span>
          </label>
          <p-select formControlName="almacen" [options]="almacenes" optionLabel="label" optionValue="value"
            placeholder="Seleccione almacén" [disabled]="!form.get('sucursal')?.value" />
        </div>

        <!-- Marca -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Marca <span class="text-red-500">*</span>
          </label>
          <p-select formControlName="marca" [options]="marcas" optionLabel="label" optionValue="value"
            placeholder="Seleccione marca" styleClass="w-full" [filter]="true" filterPlaceholder="Buscar..." />
        </div>

        <!-- Modelo -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Modelo <span class="text-red-500">*</span>
          </label>
          <p-select formControlName="modelo" [options]="modelos" optionLabel="label" optionValue="value"
            placeholder="Seleccione modelo" styleClass="w-full fixed-select" [filter]="true"
            filterPlaceholder="Buscar..." [disabled]="!form.get('marca')?.value" />
        </div>

        <!-- Color -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Color
          </label>
          <p-select formControlName="color" [options]="colores" optionLabel="label" optionValue="value"
            placeholder="Seleccione color" styleClass="w-full" [filter]="true" filterPlaceholder="Buscar..." />
        </div>

        <!-- Kilometraje -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Kilometraje
          </label>
          <input type="number" pInputText [(ngModel)]="kilometraje" [ngModelOptions]="{standalone: true}"
            placeholder="Ingrese kilometraje" class="w-full h-11" />
        </div>

        <!-- Condición -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Condición
          </label>
          <div class="flex gap-4 items-center h-11">
            <div class="flex items-center gap-2">
              <input type="checkbox" [(ngModel)]="condicionNuevo" [ngModelOptions]="{standalone: true}" id="nuevo"
                class="w-4 h-4" />
              <label for="nuevo" class="text-sm text-gray-700 dark:text-gray-300">Nuevo</label>
            </div>
            <div class="flex items-center gap-2">
              <input type="checkbox" [(ngModel)]="condicionActivo" [ngModelOptions]="{standalone: true}" id="activo"
                class="w-4 h-4" />
              <label for="activo" class="text-sm text-gray-700 dark:text-gray-300">Activo</label>
            </div>
          </div>
        </div>

        <!-- N° Chasis -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            N° de Chasis <span class="text-red-500">*</span>
          </label>
          <input type="text" pInputText [(ngModel)]="nroChasis" [ngModelOptions]="{standalone: true}"
            placeholder="Número de chasis" class="w-full h-11" />
        </div>

        <!-- N° Stock -->
        <div class="flex flex-col gap-2 sm:col-span-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            N° de Stock <span class="text-red-500">*</span>
          </label>
          <input type="text" pInputText [(ngModel)]="nroStock" [ngModelOptions]="{standalone: true}"
            placeholder="Número de stock" class="w-full h-11" />
        </div>
      </form>
    </div>

    <!-- EQUIPAMIENTO DE LA UNIDAD -->
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-4 sm:p-6 mb-4">
      <h2 class="text-base sm:text-lg font-bold text-gray-800 dark:text-white mb-4">
        EQUIPAMIENTO DE LA UNIDAD
      </h2>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <!-- Columna Izquierda -->
        <div class="space-y-3">
          <div *ngFor="let item of equipamientoCol1"
            class="flex items-center justify-between p-2 rounded hover:bg-gray-50 dark:hover:bg-slate-700">
            <span class="text-sm text-gray-700 dark:text-gray-300">
              {{ item.descripcion }}
            </span>
            <div class="flex gap-3">
              <div class="flex items-center gap-1">
                <input type="radio" [name]="item.descripcion" [(ngModel)]="item.valor" value="NO"
                  [id]="item.descripcion + '_no'" class="w-4 h-4" />
                <label [for]="item.descripcion + '_no'" class="text-xs text-gray-600 dark:text-gray-400">NO</label>
              </div>
              <div class="flex items-center gap-1">
                <input type="radio" [name]="item.descripcion" [(ngModel)]="item.valor" value="SI"
                  [id]="item.descripcion + '_si'" class="w-4 h-4" />
                <label [for]="item.descripcion + '_si'" class="text-xs text-gray-600 dark:text-gray-400">SÍ</label>
              </div>
              <div class="flex items-center gap-1">
                <input type="radio" [name]="item.descripcion" [(ngModel)]="item.valor" value="NC"
                  [id]="item.descripcion + '_nc'" class="w-4 h-4" />
                <label [for]="item.descripcion + '_nc'" class="text-xs text-gray-600 dark:text-gray-400">NC</label>
              </div>
            </div>
          </div>
        </div>

        <!-- Columna Derecha -->
        <div class="space-y-3">
          <div *ngFor="let item of equipamientoCol2"
            class="flex items-center justify-between p-2 rounded hover:bg-gray-50 dark:hover:bg-slate-700">
            <span class="text-sm text-gray-700 dark:text-gray-300">
              {{ item.descripcion }}
            </span>
            <div class="flex gap-3">
              <div class="flex items-center gap-1">
                <input type="radio" [name]="item.descripcion" [(ngModel)]="item.valor" value="NO"
                  [id]="item.descripcion + '_no'" class="w-4 h-4" />
                <label [for]="item.descripcion + '_no'" class="text-xs text-gray-600 dark:text-gray-400">NO</label>
              </div>
              <div class="flex items-center gap-1">
                <input type="radio" [name]="item.descripcion" [(ngModel)]="item.valor" value="SI"
                  [id]="item.descripcion + '_si'" class="w-4 h-4" />
                <label [for]="item.descripcion + '_si'" class="text-xs text-gray-600 dark:text-gray-400">SÍ</label>
              </div>
              <div class="flex items-center gap-1">
                <input type="radio" [name]="item.descripcion" [(ngModel)]="item.valor" value="NC"
                  [id]="item.descripcion + '_nc'" class="w-4 h-4" />
                <label [for]="item.descripcion + '_nc'" class="text-xs text-gray-600 dark:text-gray-400">NC</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- DATOS DE TRANSPORTE -->
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-4 sm:p-6 mb-4">
      <h2 class="text-base sm:text-lg font-bold text-gray-800 dark:text-white mb-4">
        DATOS DE TRANSPORTE
      </h2>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Transportista -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Transportista
          </label>
          <input type="text" pInputText [(ngModel)]="transportista" placeholder="Nombre del transportista"
            class="w-full h-11" />
        </div>

        <!-- Conductor -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Conductor
          </label>
          <input type="text" pInputText [(ngModel)]="conductor" placeholder="Nombre del conductor"
            class="w-full h-11" />
        </div>

        <!-- Fecha de Llegada -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Fecha de Llegada
          </label>
          <p-datepicker [(ngModel)]="fechaLlegada" dateFormat="dd/mm/yy" [showIcon]="true" inputStyleClass="w-full h-11"
            styleClass="w-full" />
        </div>

        <!-- Observaciones -->
        <div class="flex flex-col gap-2 sm:col-span-2 lg:col-span-3">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Observaciones
          </label>
          <textarea pTextarea [(ngModel)]="observaciones" rows="4" placeholder="Observaciones adicionales"
            class="w-full">
          </textarea>
        </div>
      </div>
    </div>

    <!-- DATOS DEL TÉCNICO PDI -->
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-4 sm:p-6 mb-4">
      <h2 class="text-base sm:text-lg font-bold text-gray-800 dark:text-white mb-4">
        DATOS DEL TÉCNICO PDI
      </h2>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- Nombre Técnico -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Nombre Técnico PDI
          </label>
          <input type="text" pInputText [(ngModel)]="nombreTecnico" placeholder="Nombre del técnico"
            class="w-full h-11" />
        </div>

        <!-- Fecha de Recepción -->
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Fecha de Recepción
          </label>
          <p-datepicker [(ngModel)]="fechaRecepcion" dateFormat="dd/mm/yy" [showIcon]="true"
            inputStyleClass="w-full h-11" styleClass="w-full" />
        </div>
      </div>
    </div>
    <!-- FOTOS DEL VEHÍCULO -->
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-4 sm:p-6 mb-4">
      <h2 class="text-base sm:text-lg font-bold text-gray-800 dark:text-white mb-4">
        FOTOS DEL VEHÍCULO
        <span class="text-sm font-normal text-gray-500 dark:text-gray-400 ml-2">
          ({{ fotos.length }}/{{ maxFotos }})
        </span>
      </h2>

      <!-- Botones de carga -->
      <div class="flex flex-col sm:flex-row gap-3 mb-4">
        <button pButton type="button" label="Tomar Foto" icon="pi pi-camera" (click)="abrirCamara()" class="h-11"
          [disabled]="fotos.length >= maxFotos" severity="secondary">
        </button>

        <label class="flex-1">
          <input type="file" accept="image/*" multiple (change)="onFileSelect($event)"
            [disabled]="fotos.length >= maxFotos" style="display: none;" #fileInput />
          <button pButton type="button" label="Subir Fotos" icon="pi pi-upload" (click)="fileInput.click()"
            class="h-11 w-full" [disabled]="fotos.length >= maxFotos" severity="secondary">
          </button>
        </label>
      </div>

      <!-- Lista de fotos -->
      <div *ngIf="fotos.length > 0" class="space-y-2">
        <div *ngFor="let foto of fotos; let i = index"
          class="flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors">

          <!-- Información de la foto -->
          <div class="flex items-center gap-3 flex-1 min-w-0">
            <div
              class="flex-shrink-0 w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
              <i class="pi pi-image text-blue-600 dark:text-blue-400 text-lg"></i>
            </div>

            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-gray-800 dark:text-white truncate">
                {{ foto.nombre }}
              </p>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                Foto #{{ i + 1 }}
              </p>
            </div>
          </div>

          <!-- Botón eliminar -->
          <button pButton type="button" icon="pi pi-trash" (click)="eliminarFoto(foto.id)"
            class="p-button-sm p-button-rounded p-button-text" pTooltip="Eliminar foto" tooltipPosition="left"
            severity="danger">
          </button>
        </div>
      </div>

      <!-- Mensaje cuando no hay fotos -->
      <div *ngIf="fotos.length === 0"
        class="text-center py-8 text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-slate-700 rounded-lg">
        <i class="pi pi-images text-4xl mb-3 block opacity-50"></i>
        <p class="text-sm font-medium">No se han agregado fotos</p>
        <p class="text-xs mt-1">Usa los botones de arriba para agregar fotos</p>
      </div>
    </div>
    <!-- BOTONES DE ACCIÓN -->
    <div class="flex flex-col sm:flex-row gap-3 justify-end">
      <button pButton type="button" label="Limpiar" icon="pi pi-refresh" (click)="limpiarFormulario()"
        class="h-11 sm:w-auto" severity="secondary">
      </button>
      <button pButton type="button" label="Guardar Checklist" icon="pi pi-save" (click)="guardarChecklist()"
        class="h-11 sm:w-auto sm:min-w-[200px]" severity="primary">
      </button>
    </div>
  </div>
</div>

<p-toast position="top-right"></p-toast>